generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ─── ENUMS ───────────────────────────────────────────────

enum Role {
  USER
  ARTISAN
  ADMIN
}

enum ArticlePosition {
  UNE            // J1-3: Front page
  FACE_UNE       // J4-6: Second page
  PAGES_4_5      // J7-8
  PAGES_6_7      // J9-10
  PAGES_8_9      // J11-12
  PAGES_10_11    // J13-16
  PAGES_12_13    // J17-21
  ARCHIVES       // J22+
}

enum ArticleCategory {
  ACTUALITE
  CULTURE
  DIASPORA
  BUSINESS
  LIFESTYLE
  OPINION
}

enum InscriptionStatus {
  PENDING
  VALIDATED
  REJECTED
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

enum AdFormat {
  SPONSORED_ARTICLE
  BANNER
  VIDEO
}

enum AdPlan {
  STARTER   // 29€/month
  PRO       // 79€/month
  PREMIUM   // 149€/month
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum JournalAdPlacement {
  BANNER
  INLINE
  VIDEO
  SIDEBAR
}

// ─── AUTH MODELS ─────────────────────────────────────────

model User {
  id             String    @id @default(cuid())
  name           String?
  email          String    @unique
  emailVerified  DateTime?
  image          String?
  password       String?
  role           Role      @default(USER)
  bio            String?
  country        String?
  phone          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  accounts    Account[]
  sessions    Session[]
  articles    Article[]
  products    Product[]
  orders      Order[]
  tickets     Ticket[]
  favorites   Favorite[]
  adCampaigns     AdCampaign[]
  officielContents OfficielContent[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ─── JOURNAL (L'AFROPÉEN) ───────────────────────────────

model Article {
  id          String          @id @default(cuid())
  title       String
  slug        String          @unique
  excerpt     String
  content     String          @db.Text
  coverImage     String?
  gradientClass  String?
  category       ArticleCategory
  position       ArticlePosition @default(UNE)
  publishedAt    DateTime        @default(now())
  dayCount       Int             @default(1)
  featured       Boolean         @default(false)
  isSponsored    Boolean         @default(false)
  sponsorName    String?
  readingTimeMin Int?
  status         ArticleStatus   @default(PUBLISHED)
  views          Int             @default(0)
  authorId    String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  author User @relation(fields: [authorId], references: [id])

  @@index([position])
  @@index([category])
  @@index([publishedAt])
}

// ─── EVENTS + TICKETING ─────────────────────────────────

model Event {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  description String   @db.Text
  coverImage  String?
  venue       String
  address     String
  date        DateTime
  endDate     DateTime?
  capacity     Int
  showCapacity Boolean  @default(true)
  program      Json?
  tiers        Json?
  priceEarly   Float
  priceStd    Float
  priceVip    Float
  published   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tickets Ticket[]

  @@index([date])
}

model Ticket {
  id              String   @id @default(cuid())
  eventId         String
  userId          String
  tier            String
  price           Float
  qrCode          String?
  stripeSessionId String?
  sessionLabel    String?
  purchasedAt     DateTime @default(now())

  event Event @relation(fields: [eventId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@index([eventId])
  @@index([userId])
}

// ─── MARKETPLACE ────────────────────────────────────────

model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String   @db.Text
  price       Float
  images      String[] // array of URLs
  category    String
  country     String
  stock       Int      @default(0)
  published   Boolean  @default(true)
  artisanId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  artisan    User        @relation(fields: [artisanId], references: [id])
  orderItems OrderItem[]
  favorites  Favorite[]

  @@index([category])
  @@index([country])
  @@index([price])
}

model Order {
  id              String      @id @default(cuid())
  userId          String
  status          OrderStatus @default(PENDING)
  total           Float
  stripeSessionId String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user  User        @relation(fields: [userId], references: [id])
  items OrderItem[]
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Float

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

// ─── DTA ADS ────────────────────────────────────────────

model AdCampaign {
  id              String   @id @default(cuid())
  userId          String
  title           String
  format          AdFormat
  plan            AdPlan
  content         String   @db.Text
  imageUrl        String?
  videoUrl        String?
  targetUrl       String
  impressions     Int      @default(0)
  clicks          Int      @default(0)
  active          Boolean  @default(true)
  stripeSubId     String?
  startDate       DateTime @default(now())
  endDate         DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@index([format])
  @@index([active])
}

// ─── L'OFFICIEL D'AFRIQUE — INSCRIPTIONS ────────────────

model Inscription {
  id          String   @id @default(cuid())
  entreprise  String
  categorie   String
  directeur   String
  adresse     String?
  ville       String
  codePostal  String?
  pays        String
  mobile      String
  telephone   String?
  email       String
  siteWeb     String?
  facebook    String?
  instagram   String?
  tiktok      String?
  whatsapp    String?
  youtube     String?
  linkedin    String?
  description String            @db.Text
  motsCles    String?
  newsletter  Boolean           @default(false)
  status      InscriptionStatus @default(PENDING)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@index([email])
  @@index([categorie])
  @@index([status])
}

// ─── L'OFFICIEL D'AFRIQUE — CONTENU ÉDITORIAL ────────────

model OfficielContent {
  id         String   @id @default(cuid())
  title      String
  slug       String   @unique
  type       String   // "article", "interview", "portrait", "guide"
  content    String   @db.Text
  excerpt    String?
  coverImage String?
  category   String
  published  Boolean  @default(false)
  authorId   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  author User @relation(fields: [authorId], references: [id])

  @@index([type])
  @@index([category])
  @@index([published])
}

// ─── JOURNAL ADS (DTA ADS JOURNAL) ──────────────────────

model JournalAd {
  id             String              @id @default(cuid())
  title          String
  description    String              @db.Text
  placement      JournalAdPlacement
  ctaText        String?
  ctaUrl         String
  imageUrl       String?
  gradientClass  String?
  iconSvg        String?             @db.Text
  price          String?
  advertiserName String?
  campaignStart  DateTime            @default(now())
  campaignEnd    DateTime?
  campaignWeeks  Int                 @default(4)
  active         Boolean             @default(true)
  impressions    Int                 @default(0)
  clicks         Int                 @default(0)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt

  @@index([placement])
  @@index([active])
}

// ─── NEWSLETTER ─────────────────────────────────────────

model NewsletterSubscriber {
  id           String   @id @default(cuid())
  email        String   @unique
  isActive     Boolean  @default(true)
  subscribedAt DateTime @default(now())
}
